{% extends 'users/base.html' %}
{% load static %}

{% block title %}
<title>Список книг</title>
{% endblock title %}

{% block content %}
<div class="container-xl">
    <form action="{% url 'books:list_books' %}" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-5 form-control">
                {{ form.as_p }}
                <button type="submit" class="btn btn-miran"> Найти </button>
            </div>
        </div>
    </form>
</div>

<h1 class="text-center">Список книг</h1>
<div class="container-fluid">
    <table class="table table-hover table-bordered">
        <thead class="table-secondary" style=" height: 50px;">
        <th class="text-center align-middle">Автор</th>
        <th class="text-center align-middle">Название книги</th>
        <th class="text-center align-middle">Статус книги</th>
        <th class="text-center align-middle">Читатель </th>
        <th class="text-center align-middle">Краткое описание книги</th>
        </thead>
        <tbody>
        {% for book in books %}
        <tr class="table-row-link" data-href="{{ book.get_absolute_url }}">
            <td class="align-middle">{{ book.author }}</td>
            <td class="align-middle">{{ book.title }}</td>
            <td style="white-space: nowrap;" class="text-center align-middle">
                {% if book.status == 'CLOSE' %} В пользовании {% else %} Свободна {% endif %}
            </td>
            <td style="white-space: nowrap" class="text-center align-middle">
                {% if book.status == 'CLOSE' %}
                {{ book.reader }}
                {% else %}
                {% endif %}
            </td>
            <td class="align-middle">{{ book.description|truncatewords:20 }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tableRows = document.querySelectorAll('.table-row-link');
        tableRows.forEach((row) => {
            row.addEventListener('click', function () {
                const href = this.getAttribute('data-href');
                if (href) {
                    window.location.href = href;
                }
            });
        });
    });
</script>
{% endblock content %}
